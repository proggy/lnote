

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>lnote &mdash; lnote 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="lnote 0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">lnote 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for lnote</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Copyright notice</span>
<span class="c"># ----------------</span>
<span class="c">#</span>
<span class="c"># Copyright (C) 2013-2014 Daniel Jung</span>
<span class="c"># Contact: djungbremen@gmail.com</span>
<span class="c">#</span>
<span class="c"># This program is free software; you can redistribute it and/or modify it</span>
<span class="c"># under the terms of the GNU General Public License as published by the Free</span>
<span class="c"># Software Foundation; either version 2 of the License, or (at your option)</span>
<span class="c"># any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="c"># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="c"># FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for</span>
<span class="c"># more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License along</span>
<span class="c"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c"># 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.</span>
<span class="c">#</span>
<span class="sd">&quot;&quot;&quot;Write notes in LaTeX format, directly from the command line. Organize the</span>
<span class="sd">notes in notebooks. Automatically create a notebook for the current day if no</span>
<span class="sd">other notebook is selected. View and edit the notes of each day or notebook.</span>
<span class="sd">Select one or more notebooks or a certain timerange and export them to a PDF</span>
<span class="sd">file, or merge them into a new notebook.</span>

<span class="sd">The default data directory is &quot;~/data/lnote&quot;. It can be overwritten by setting</span>
<span class="sd">the environment variable LNOTE_DIR.</span>

<span class="sd">To do:</span>
<span class="sd">--&gt; add -l/--line options to select a line or a range of lines</span>
<span class="sd">--&gt; add a search command (full text search feature), return notebook names</span>
<span class="sd">--&gt; add a command &quot;clear&quot; (or similar) to delete all temporary directories</span>
<span class="sd">--&gt; do not overwrite graphic files when submitting a figure, instead rename</span>

<span class="sd">Ideas for the future:</span>
<span class="sd">--&gt; work with hardlinks instead of copying the graphics files? Not good if</span>
<span class="sd">    renaming will be possible in the future.</span>

<span class="sd">Written by Daniel Jung, Jacobs University Bremen (2012).</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
<span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2013-11-29&#39;</span>
<span class="kn">import</span> <span class="nn">commands</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">optparse2</span> <span class="kn">as</span> <span class="nn">optparse</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">optparse</span>


<span class="c"># set default data directory, create it if it does not exist</span>
<span class="n">LNOTE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LNOTE_DIR&#39;</span><span class="p">,</span> <span class="s">&#39;~/data/lnote&#39;</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">)</span>


<span class="c">#=====================#</span>
<span class="c"># Command definitions #</span>
<span class="c">#=====================#</span>


<div class="viewcode-block" id="create"><a class="viewcode-back" href="../index.html#lnote.create">[docs]</a><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a notebook.&quot;&quot;&quot;</span>
    <span class="c"># 2012-10-30 - 2012-10-30</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog create [options] NAME &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;[NAME2 NAME3 ...]&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                               <span class="n">description</span><span class="o">=</span><span class="n">create</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--template&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;create new notebook from template &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;(duplicate an existing notebook)&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;be verbose&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

    <span class="c"># check if template exists</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span> \
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span><span class="p">)):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote create: template &quot;</span><span class="si">%s</span><span class="s">&quot; &#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span> <span class="o">+</span> \
                            <span class="s">&#39;not found&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">posargs</span><span class="p">:</span>
        <span class="c"># check if notebook with that name already exists</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">):</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote create: cannot create notebook &#39;</span> <span class="o">+</span> \
                                <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;: file exists&#39;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="k">continue</span>

        <span class="c"># create notebook</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;mkdir </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span><span class="p">:</span>
            <span class="c"># copy the template file</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;cp </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;echo -n &gt; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dst</span>

        <span class="c"># copy all other files from the template as well</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">:</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;cp </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="listn"><a class="viewcode-back" href="../index.html#lnote.listn">[docs]</a><span class="k">def</span> <span class="nf">listn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List notebooks.&quot;&quot;&quot;</span>
    <span class="c"># 2012-10-30 - 2013-11-08</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog list [options] &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;[PATTERN [PATTERN2 PATTERN3 ...]]&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                               <span class="n">description</span><span class="o">=</span><span class="n">listn</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="s">&#39;--long&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;use a long listing format. The columns, from left &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;to right: 1. number of files, &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;2. linecount of tex-file, &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;3. total size in bytes, &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;4. modification time, 5. notebook name&#39;</span><span class="p">)</span>
    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">posargs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span>

    <span class="c"># select notebooks according to patterns</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">notebooks</span> <span class="o">=</span> <span class="n">select_notebooks</span><span class="p">(</span><span class="o">*</span><span class="n">posargs</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">forgiving</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SelectNotebookError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> \
            <span class="s">&#39;lnote list: notebook not found: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">notebooks</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c"># display selected notebooks</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">long</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">:</span>
            <span class="c"># collect some information about the notebook</span>
            <span class="n">dirsize</span> <span class="o">=</span> <span class="n">get_size</span><span class="p">(</span><span class="n">dirpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">))</span>
            <span class="n">dirsize_digits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">get_size</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">)))</span>
            <span class="n">modtime</span> <span class="o">=</span> <span class="n">get_mtime</span><span class="p">(</span><span class="n">dirpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">))</span>
            <span class="n">filecount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">)))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">linecount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
            <span class="k">print</span> <span class="s">&#39;</span><span class="si">% 3i</span><span class="s"> </span><span class="si">% 4i</span><span class="s"> </span><span class="si">% *i</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> \
                  <span class="o">%</span> <span class="p">(</span><span class="n">filecount</span><span class="p">,</span> <span class="n">linecount</span><span class="p">,</span> <span class="n">dirsize_digits</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span>
                     <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">modtime</span><span class="p">),</span> <span class="n">notebook</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">printcols</span><span class="p">(</span><span class="n">notebooks</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="rename"><a class="viewcode-back" href="../index.html#lnote.rename">[docs]</a><span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rename a notebook.&quot;&quot;&quot;</span>
    <span class="c"># 2012-10-30 - 2012-10-30</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog rename [options] OLD_NAME &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;NEW_NAME&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                               <span class="n">description</span><span class="o">=</span><span class="n">rename</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;be verbose&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote rename: wrong number of parameters, &#39;</span> <span class="o">+</span> \
                            <span class="s">&#39;expecting exactly two (old and new notebook name)&#39;</span>
    <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="o">=</span> <span class="n">posargs</span>

    <span class="c"># check if notebook exists</span>
    <span class="k">if</span> <span class="n">old</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote rename: cannot rename &quot;</span><span class="si">%s</span><span class="s">&quot;: &#39;</span> <span class="o">%</span> <span class="n">old</span> <span class="o">+</span> \
                            <span class="s">&#39;no such file&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># check if notebook with that name already exists</span>
    <span class="k">if</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote rename: cannot rename notebook to &#39;</span> <span class="o">+</span> \
                            <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;: file exists&#39;</span> <span class="o">%</span> <span class="n">new</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># rename notebook</span>
    <span class="n">olddir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">old</span><span class="p">)</span>
    <span class="n">newdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">olddir</span><span class="p">,</span> <span class="n">newdir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;mv </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">olddir</span><span class="p">,</span> <span class="n">newdir</span><span class="p">)</span>
    <span class="n">oldtex</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">)</span>
    <span class="n">newtex</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">new</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">oldtex</span><span class="p">,</span> <span class="n">newtex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;mv </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oldtex</span><span class="p">,</span> <span class="n">newtex</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="merge"><a class="viewcode-back" href="../index.html#lnote.merge">[docs]</a><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merge several notebooks into another (append all source notebooks to the</span>
<span class="sd">    target notebook). If the target notebook does not exist, create it.&quot;&quot;&quot;</span>
    <span class="c"># 2012-10-31 - 2012-11-23</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog merge [options] &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;SOURCE_NOTEBOOKS TARGET_NOTEBOOK&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                               <span class="n">description</span><span class="o">=</span><span class="n">merge</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;be verbose&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--date&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;show date of notebooks as marginal notes&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="n">notebooks</span> <span class="o">=</span> <span class="n">select_notebooks</span><span class="p">(</span><span class="o">*</span><span class="n">posargs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">new</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">posargs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">forgiving</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># check if all notebooks exist</span>
    <span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">notebook</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">):</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote merge: cannot load notebook &#39;</span> <span class="o">+</span> \
                                <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;: no such file&#39;</span> <span class="o">%</span> <span class="n">notebook</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># merge notebooks</span>
    <span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">:</span>
        <span class="c"># load tex-file of source notebook and append it to target notebook</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">linebreak</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="n">marginnote</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">texttt{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">notebook</span><span class="p">)</span>
        <span class="n">append_text</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;cat </span><span class="si">%s</span><span class="s"> &gt;&gt; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">),</span> <span class="n">texpath</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>

        <span class="c"># copy all other files from the source notebook</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">notebook</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="n">notebook</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;cp </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="edit"><a class="viewcode-back" href="../index.html#lnote.edit">[docs]</a><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open notebook in a text editor. If multiple notebooks are given, open</span>
<span class="sd">    them side by side.&quot;&quot;&quot;</span>
    <span class="c"># 2012-10-31 - 2012-11-01</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog edit [options] NOTEBOOK &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;[NOTEBOOK2 NOTEBOOK3 ...]&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                               <span class="n">description</span><span class="o">=</span><span class="n">edit</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-e&#39;</span><span class="p">,</span> <span class="s">&#39;--editor&#39;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LNOTE_EDITOR&#39;</span><span class="p">,</span> <span class="s">&#39;vim&#39;</span><span class="p">),</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;set editor. Default can be overwritten with &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;environment variable LNOTE_EDITOR&#39;</span><span class="p">)</span>
    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">posargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">date2filename</span><span class="p">(</span><span class="o">*</span><span class="n">jdn2greg</span><span class="p">(</span><span class="n">opt2day</span><span class="p">(</span><span class="s">&#39;today&#39;</span><span class="p">)))]</span>

    <span class="c"># select notebooks</span>
    <span class="n">notebooks</span> <span class="o">=</span> <span class="n">select_notebooks</span><span class="p">(</span><span class="o">*</span><span class="n">posargs</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># open notebooks side by side</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">)</span> <span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">]</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">opts</span><span class="o">.</span><span class="n">editor</span><span class="p">]</span> <span class="o">+</span> <span class="n">paths</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                    <span class="n">stdout</span><span class="o">=</span><span class="bp">None</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">editor</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;vi&#39;</span><span class="p">,</span> <span class="s">&#39;vim&#39;</span><span class="p">)</span>
                    <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/dev/null&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="delete"><a class="viewcode-back" href="../index.html#lnote.delete">[docs]</a><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delete a notebook.&quot;&quot;&quot;</span>
    <span class="c"># 2012-10-31 - 2012-10-31</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog delete [options] NOTEBOOK &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;[NOTEBOOK2 NOTEBOOK3 ...]&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                               <span class="n">description</span><span class="o">=</span><span class="n">delete</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;--force&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;ignore nonexistent notebooks, never prompt&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--test&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;test mode, only show what would have been deleted&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

    <span class="c"># select notebooks</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">notebooks</span> <span class="o">=</span> <span class="n">select_notebooks</span><span class="p">(</span><span class="o">*</span><span class="n">posargs</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                     <span class="n">forgiving</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SelectNotebookError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> \
            <span class="s">&#39;lnote delete: notebook not found: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># delete notebooks</span>
    <span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">:</span>
        <span class="c"># prompt</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">test</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;delete notebook &quot;</span><span class="si">%s</span><span class="s">&quot;? &#39;</span> <span class="o">%</span> <span class="n">notebook</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">answer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="s">&#39;yes&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
                <span class="k">continue</span>

        <span class="c"># delete</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">test</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;would have deleted &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">notebook</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">notebook</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="export"><a class="viewcode-back" href="../index.html#lnote.export">[docs]</a><span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Export a notebook or selection of notebooks (for now only to PDF</span>
<span class="sd">    format).&quot;&quot;&quot;</span>
    <span class="c"># 2012-10-31 - 2012-11-23</span>

    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog export [options] &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;[PATTERN [PATTERN2 PATTERN3 ...]] &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;OUTPUT_FILE&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                               <span class="n">description</span><span class="o">=</span><span class="n">export</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="s">&#39;--export-merge&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;mergetemp&#39;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="s">&#39;temp-export-merge&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;set temporary notebook name that is used to merge &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;the selected notebooks&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="s">&#39;--export-compile&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;compiletemp&#39;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="s">&#39;/tmp/export-compile&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;set temporary directory that is used to compile the &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;LaTeX file of the merged notebook&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;be verbose, print compiler messages&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--date&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;show date of notebooks as marginal notes&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">posargs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;today&#39;</span><span class="p">,</span> <span class="n">posargs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="c"># select notebooks</span>
    <span class="n">notebooks</span> <span class="o">=</span> <span class="n">select_notebooks</span><span class="p">(</span><span class="o">*</span><span class="n">posargs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">notebooks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote export: no notebook selected&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># select target</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">posargs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">+=</span> <span class="s">&#39;.pdf&#39;</span>

    <span class="c"># merge notebooks into temporary notebook</span>
    <span class="n">delete</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">,</span> <span class="s">&#39;--force&#39;</span><span class="p">)</span>
    <span class="n">mergeargs</span> <span class="o">=</span> <span class="n">notebooks</span> <span class="o">+</span> <span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
        <span class="n">mergeargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--date&#39;</span><span class="p">)</span>
    <span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">mergeargs</span><span class="p">)</span>

    <span class="c"># copy files over to temporary compile directory</span>
    <span class="c">#if os.path.exists(opts.compiletemp): ## aux file must not be deleted</span>
        <span class="c">#shutil.rmtree(opts.compiletemp)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">compiletemp</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">compiletemp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">compiletemp</span><span class="p">)</span>

    <span class="c"># add LaTeX preample and epilog to the tex-file and copy it over</span>
    <span class="n">preamble</span> <span class="o">=</span> <span class="s">&#39;\documentclass{scrartcl}</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> \
               <span class="s">&#39;\usepackage{amsmath}</span><span class="se">\n</span><span class="s">\usepackage{amsthm}</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> \
               <span class="s">&#39;\usepackage{graphicx}</span><span class="se">\n</span><span class="s">\usepackage{commath}</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> \
               <span class="s">&#39;</span><span class="se">\\</span><span class="s">begin{document}</span><span class="se">\n\n</span><span class="s">&#39;</span>
    <span class="n">epilog</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">end{document}&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">compiletemp</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">preamble</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">epilog</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c"># use pdflatex to compile PDF document</span>
    <span class="n">cdcmd</span> <span class="o">=</span> <span class="s">&#39;cd </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">compiletemp</span>
    <span class="n">latexcmd</span> <span class="o">=</span> <span class="s">&#39;pdflatex </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span>
    <span class="c">#os.system(&#39;%s;%s&#39; % (cdcmd, latexcmd))</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cdcmd</span><span class="p">,</span> <span class="n">latexcmd</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">stderr</span><span class="o">=</span><span class="bp">None</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span> <span class="k">else</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                    <span class="n">stdout</span><span class="o">=</span><span class="bp">None</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span> <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/dev/null&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">compiletemp</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="o">+</span><span class="s">&#39;.pdf&#39;</span><span class="p">),</span>
                        <span class="n">target</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> \
            <span class="s">&#39;lnote export: export failed&#39;</span> <span class="o">+</span> \
            <span class="p">(</span><span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span> <span class="k">else</span> <span class="s">&#39;, use --verbose to get details&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="path"><a class="viewcode-back" href="../index.html#lnote.path">[docs]</a><span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get path of the directory of a certain notebook.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># 2013-11-08 - 2013-11-08</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog path [options] NOTEBOOK &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;[NOTEBOOK2 NOTEBOOK3 ...]&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--tex&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;get path of the tex file instead of the directory&#39;</span><span class="p">)</span>
    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">posargs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;today&#39;</span><span class="p">]</span>

    <span class="c"># select notebooks</span>
    <span class="n">notebooks</span> <span class="o">=</span> <span class="n">select_notebooks</span><span class="p">(</span><span class="o">*</span><span class="n">posargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">notebooks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote path: no notebook selected&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">tex</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">notebook</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">dirpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="view"><a class="viewcode-back" href="../index.html#lnote.view">[docs]</a><span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;View a notebook or a selection of notebooks.</span>

<span class="sd">    To do:</span>
<span class="sd">    --&gt; add -l/--line option to select a line or a range of lines&quot;&quot;&quot;</span>
    <span class="c"># 2012-11-01 - 2012-11-23</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog view [options] NOTEBOOK &#39;</span> <span class="o">+</span>
                                     <span class="s">&#39;[NOTEBOOK2 NOTEBOOK3 ...]&#39;</span><span class="p">,</span>
                               <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-e&#39;</span><span class="p">,</span> <span class="s">&#39;--export&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;view exported version (for now only PDF)&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-p&#39;</span><span class="p">,</span> <span class="s">&#39;--pdfviewer&#39;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;LNOTE_PDFVIEWER&#39;</span><span class="p">,</span> <span class="s">&#39;okular&#39;</span><span class="p">),</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;set PDF viewer. Default can be overwritten with &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;environment variable LNOTE_PDFVIEWER&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="s">&#39;--view-merge&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;mergetemp&#39;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="s">&#39;temp-view-merge&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;set temporary notebook name that is used to merge &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;the selected notebooks&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="s">&#39;--view-compile&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;compiletemp&#39;</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="s">&#39;/tmp/view-compile&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;set temporary directory that is used to compile the &#39;</span> <span class="o">+</span>
                       <span class="s">&#39;LaTeX file of the merged notebook&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;be verbose, print compiler messages&#39;</span><span class="p">)</span>
    <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--date&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s">&#39;show date of notebooks as marginal notes&#39;</span><span class="p">)</span>

    <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">posargs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;today&#39;</span><span class="p">]</span>

    <span class="c"># select notebooks</span>
    <span class="n">notebooks</span> <span class="o">=</span> <span class="n">select_notebooks</span><span class="p">(</span><span class="o">*</span><span class="n">posargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">notebooks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote view: no notebook selected&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">export</span><span class="p">:</span>
        <span class="c"># compile the LaTeX file of the selected notebooks</span>
        <span class="n">pdffile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">),</span> <span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="o">+</span><span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">exportargs</span> <span class="o">=</span> <span class="n">notebooks</span><span class="o">+</span><span class="p">[</span><span class="n">pdffile</span><span class="p">,</span> <span class="s">&#39;--export-merge&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">,</span>
                                <span class="s">&#39;--export-compile&#39;</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">compiletemp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">exportargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--verbose&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="n">exportargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--date&#39;</span><span class="p">)</span>
        <span class="n">export</span><span class="p">(</span><span class="o">*</span><span class="n">exportargs</span><span class="p">)</span>

        <span class="c"># open the PDF file in a PDF viewer (if not already open)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s">&#39;ps aux&#39;</span><span class="p">,</span>
                                        <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">pdfviewer</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">pdffile</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;lnote view: document still open in PID </span><span class="si">%s</span><span class="s">&#39;</span> \
                        <span class="o">%</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> &amp;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">pdfviewer</span><span class="p">,</span> <span class="n">pdffile</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="bp">None</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span> <span class="k">else</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="bp">None</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span> <span class="k">else</span>
                            <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/dev/null&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># merge notebooks into temporary notebook and display the tex-file</span>
        <span class="n">delete</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">,</span> <span class="s">&#39;--force&#39;</span><span class="p">)</span>
        <span class="n">mergeargs</span> <span class="o">=</span> <span class="n">notebooks</span><span class="o">+</span><span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="n">mergeargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--date&#39;</span><span class="p">)</span>
        <span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">mergeargs</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">mergetemp</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">print</span> <span class="n">text</span>

</div>
<div class="viewcode-block" id="text"><a class="viewcode-back" href="../index.html#lnote.text">[docs]</a><span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Add text to a notebook. This can be any LaTeX-compatible code.</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog text [options] TEXT...&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">text</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;--file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;read text from the given text file&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="s">&#39;--stdin&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;read text from standard input&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;--help&#39;</span><span class="p">]</span>
  <span class="n">op</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

  <span class="c"># select notebook</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>
  <span class="k">except</span> <span class="n">SelectNotebookError</span><span class="p">:</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> \
          <span class="s">&#39;lnote text: notebook not found: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">notebook</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

  <span class="c"># append text from command line arguments</span>
  <span class="n">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posargs</span><span class="p">))</span>

  <span class="c"># append text from the given text file</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
    <span class="n">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

  <span class="c"># read text from standard input</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="linebreak"><a class="viewcode-back" href="../index.html#lnote.linebreak">[docs]</a><span class="k">def</span> <span class="nf">linebreak</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Add a linebreak (an empty line) to a notebook.</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog linebreak [options]&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                             <span class="n">description</span><span class="o">=</span><span class="n">linebreak</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-#&#39;</span><span class="p">,</span> <span class="s">&#39;--number&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;set number of linebreaks&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> \
          <span class="s">&#39;lnote linebreak: not expecting any positional parameters&#39;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">op</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;bad number of linebreaks: </span><span class="si">%i</span><span class="s">. &#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">number</span><span class="o">+</span>\
             <span class="s">&#39;Must be non-negative integer&#39;</span><span class="p">)</span>

  <span class="c"># select notebook</span>
  <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>

  <span class="c"># append empty lines</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
    <span class="n">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="section"><a class="viewcode-back" href="../index.html#lnote.section">[docs]</a><span class="k">def</span> <span class="nf">section</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Add a section to a notebook.</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-11-19&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog section [options] TITLE...&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                             <span class="n">description</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="s">&#39;--level&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set level&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-#&#39;</span><span class="p">,</span> <span class="s">&#39;--numbered&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;add numbered section&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

  <span class="c"># determine section level</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">texcmd</span> <span class="o">=</span> <span class="s">&#39;section&#39;</span>
  <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">texcmd</span> <span class="o">=</span> <span class="s">&#39;subsection&#39;</span>
  <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">texcmd</span> <span class="o">=</span> <span class="s">&#39;subsubsection&#39;</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">op</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;bad section level: </span><span class="si">%i</span><span class="s">. Must be out of (1, 2, 3)&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>

  <span class="c"># numbered sections</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">numbered</span><span class="p">:</span>
    <span class="n">texcmd</span> <span class="o">+=</span> <span class="s">&#39;*&#39;</span>

  <span class="c"># select notebook</span>
  <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>

  <span class="c"># add the section</span>
  <span class="n">title</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span>
  <span class="n">linebreak</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">)</span> <span class="c">#&#39;--number&#39;, &#39;3&#39;</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\</span><span class="si">%s</span><span class="s">{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">texcmd</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="paragraph"><a class="viewcode-back" href="../index.html#lnote.paragraph">[docs]</a><span class="k">def</span> <span class="nf">paragraph</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Add a titled paragraph to a notebook.</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog paragraph [options] TITLE...&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                             <span class="n">description</span><span class="o">=</span><span class="n">paragraph</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="s">&#39;--level&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set level&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

  <span class="c"># determine section level</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">texcmd</span> <span class="o">=</span> <span class="s">&#39;paragraph&#39;</span>
  <span class="k">elif</span> <span class="n">opts</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">texcmd</span> <span class="o">=</span> <span class="s">&#39;subparagraph&#39;</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">op</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;bad paragraph level: </span><span class="si">%i</span><span class="s">. Must be out of (1, 2)&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>

  <span class="c"># select notebook</span>
  <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>

  <span class="c"># add the paragraph</span>
  <span class="n">title</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span>
  <span class="n">linebreak</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">)</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\</span><span class="si">%s</span><span class="s">{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">texcmd</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="equation"><a class="viewcode-back" href="../index.html#lnote.equation">[docs]</a><span class="k">def</span> <span class="nf">equation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Add an equation to a notebook.</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog equation [options] TITLE...&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                             <span class="n">description</span><span class="o">=</span><span class="n">equation</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-#&#39;</span><span class="p">,</span> <span class="s">&#39;--numbered&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;add numbered equation&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="s">&#39;--label&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set label&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

  <span class="c"># select notebook</span>
  <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>

  <span class="c"># add the equation</span>
  <span class="n">eq</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span>
  <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">numbered</span> <span class="k">else</span> <span class="s">&#39;*&#39;</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">begin{equation</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="n">eq</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
    <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\label{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">end{equation</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="figure"><a class="viewcode-back" href="../index.html#lnote.figure">[docs]</a><span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Add a figure to a notebook.</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.</span>

<span class="sd">  To do:</span>
<span class="sd">  --&gt; determine size of the graphics file and choose width and height</span>
<span class="sd">      accordingly</span>
<span class="sd">  --&gt; do not overwrite existing graphics files (maybe only by option), instead</span>
<span class="sd">      rename the file&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-11-20&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog figure [options] TITLE...&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                             <span class="n">description</span><span class="o">=</span><span class="n">figure</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="s">&#39;--caption&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set caption&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="s">&#39;--label&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set label&#39;</span><span class="p">)</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

  <span class="c"># select notebook</span>
  <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>

  <span class="c"># check if all graphics files exist</span>
  <span class="k">for</span> <span class="n">graphicsfile</span> <span class="ow">in</span> <span class="n">posargs</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">graphicsfile</span><span class="p">):</span>
      <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> \
            <span class="s">&#39;lnote figure: cannot copy </span><span class="si">%s</span><span class="s">: no such file&#39;</span> <span class="o">%</span> <span class="n">graphicsfile</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

  <span class="c"># add the figure</span>
  <span class="n">linebreak</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">)</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">begin{figure}&#39;</span><span class="p">)</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\centering&#39;</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">graphicsfile</span> <span class="ow">in</span> <span class="n">posargs</span><span class="p">:</span>
    <span class="c"># copy the graphics file into the notebook directory</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">graphicsfile</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">notebook</span><span class="p">))</span>

    <span class="c"># add graphics file</span>
    <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\includegraphics[width=.72</span><span class="se">\\</span><span class="s">textwidth]{</span><span class="si">%s</span><span class="s">}&#39;</span>\
                                 <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">graphicsfile</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">caption</span><span class="p">:</span>
    <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\caption{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">caption</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
    <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\label{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span>
           <span class="s">&#39;\label{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">posargs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">end{figure}&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="prune"><a class="viewcode-back" href="../index.html#lnote.prune">[docs]</a><span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Remove the last line of a notebook.</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.</span>

<span class="sd">  To do:</span>
<span class="sd">  --&gt; negative numbers remove lines from the beginning of the notebook&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-11-01&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog prune [options]&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                             <span class="n">description</span><span class="o">=</span><span class="n">prune</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-#&#39;</span><span class="p">,</span> <span class="s">&#39;--number&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;set number of lines to remove&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;--force&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;never prompt&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote prune: not expecting any positional parameters&#39;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">op</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;bad number of lines: </span><span class="si">%i</span><span class="s">. &#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">number</span><span class="o">+</span>\
             <span class="s">&#39;Must be non-negative integer&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span>

  <span class="c"># select notebook</span>
  <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>

  <span class="c"># copy the whole file, but leave out the last couple of lines</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">opts</span><span class="o">.</span><span class="n">number</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span>

  <span class="c"># prompt</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">:</span>
    <span class="c"># print the lines</span>
    <span class="n">select</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">opts</span><span class="o">.</span><span class="n">number</span><span class="p">:])</span> <span class="c">#.strip()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\033</span><span class="s">[7m</span><span class="si">%s</span><span class="se">\033</span><span class="s">[0m&#39;</span> <span class="o">%</span> <span class="n">select</span><span class="p">)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;remove the above line</span><span class="si">%s</span><span class="s"> from notebook &quot;</span><span class="si">%s</span><span class="s">&quot;? &#39;</span> \
              <span class="o">%</span> <span class="p">(</span><span class="n">plural</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="n">notebook</span><span class="p">)</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">answer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="s">&#39;yes&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
      <span class="k">return</span>

  <span class="c"># overwrite tex-file, leave out the last couple of lines</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="n">opts</span><span class="o">.</span><span class="n">number</span><span class="p">]:</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="item"><a class="viewcode-back" href="../index.html#lnote.item">[docs]</a><span class="k">def</span> <span class="nf">item</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Add a list item to a notebook. If the notebook ends with a list of the</span>
<span class="sd">  chosen type, continue that list.</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-11-01&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-11-01&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog item [options] TEXT...&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--type&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;itemize&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set list type&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="s">&#39;--label&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set label&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

  <span class="n">ITEMIZE</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">ENUMERATE</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="k">if</span> <span class="s">&#39;itemize&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="n">listtype</span> <span class="o">=</span> <span class="n">ITEMIZE</span>
  <span class="k">elif</span> <span class="s">&#39;enumerate&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="n">listtype</span> <span class="o">=</span> <span class="n">ENUMERATE</span>
  <span class="k">elif</span> <span class="s">&#39;description&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="n">listtype</span> <span class="o">=</span> <span class="n">DESCRIPTION</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;lnote item: unknown list type: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">type</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">listtype</span> <span class="ow">is</span> <span class="n">ITEMIZE</span><span class="p">:</span>
    <span class="n">listtypename</span> <span class="o">=</span> <span class="s">&#39;itemize&#39;</span>
  <span class="k">elif</span> <span class="n">listtype</span> <span class="ow">is</span> <span class="n">ENUMERATE</span><span class="p">:</span>
    <span class="n">listtypename</span> <span class="o">=</span> <span class="s">&#39;enumerate&#39;</span>
  <span class="k">elif</span> <span class="n">listtype</span> <span class="ow">is</span> <span class="n">DESCRIPTION</span><span class="p">:</span>
    <span class="n">listtypename</span> <span class="o">=</span> <span class="s">&#39;description&#39;</span>

  <span class="c"># select notebook</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>
  <span class="k">except</span> <span class="n">SelectNotebookError</span><span class="p">:</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> \
          <span class="s">&#39;lnote list: notebook not found: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opts</span><span class="o">.</span><span class="n">notebook</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

  <span class="c"># check last line of the notebook</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
  <span class="c">#while not lines[-1].strip():</span>
    <span class="c">#lines = lines[:-1]</span>
  <span class="k">if</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">end{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">listtypename</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">prune</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;--force&#39;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">begin{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">listtypename</span><span class="p">)</span>

  <span class="c"># append item</span>
  <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\item </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posargs</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\item[</span><span class="si">%s</span><span class="s">] </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posargs</span><span class="p">)))</span>

  <span class="c"># end list environment</span>
  <span class="n">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">end{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">listtypename</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="marginnote"><a class="viewcode-back" href="../index.html#lnote.marginnote">[docs]</a><span class="k">def</span> <span class="nf">marginnote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Add a marginal note to the notebook (using the LaTeX command</span>
<span class="sd">  &quot;marginpar&quot;).</span>

<span class="sd">  If the selected notebook does not exist, it is created. By default, today&#39;s</span>
<span class="sd">  notebook is used.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-11-15&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-11-15&#39;</span>

  <span class="n">op</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s">&#39;%prog marginnote [options] TEXT...&#39;</span><span class="p">,</span>
                             <span class="n">version</span><span class="o">=</span><span class="n">__modified__</span><span class="p">,</span>
                             <span class="n">description</span><span class="o">=</span><span class="n">marginnote</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-n&#39;</span><span class="p">,</span> <span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;select notebook&#39;</span><span class="p">)</span>
  <span class="n">op</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">opts</span><span class="p">,</span> <span class="n">posargs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

  <span class="c"># select notebook</span>
  <span class="n">notebook</span> <span class="o">=</span> <span class="n">select_notebook</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">notebook</span><span class="p">)</span>

  <span class="c"># add the marginal note</span>
  <span class="n">notetext</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posargs</span><span class="p">)</span>
  <span class="n">text</span><span class="p">(</span><span class="s">&#39;--notebook&#39;</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="s">&#39;\marginpar{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="n">notetext</span><span class="p">)</span>


<span class="c">#=====================#</span>
<span class="c"># Auxiliary functions #</span>
<span class="c">#=====================#</span>

</div>
<div class="viewcode-block" id="printcols"><a class="viewcode-back" href="../index.html#lnote.printcols">[docs]</a><span class="k">def</span> <span class="nf">printcols</span><span class="p">(</span><span class="n">strlist</span><span class="p">,</span> <span class="n">ret</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Print the strings in the given list in column by column (similar the bash</span>
<span class="sd">  command &quot;ls&quot;), respecting the width of the shell window. If ret is True, give</span>
<span class="sd">  back the resulting string instead of printing it to stdout.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-09-26&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-11-19&#39;</span>
  <span class="c"># based on tb.misc.printcols (written 2011-09-13)</span>
  <span class="c"># former tb.printcols from 2011-02-13 until 2011-08-02</span>
  <span class="c"># former mytools.printcols</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span>
  <span class="n">numstr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span>
  <span class="n">cols</span> <span class="o">=</span> <span class="n">get_cols</span><span class="p">()</span>
  <span class="n">maxwidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strlist</span><span class="p">])</span>
  <span class="n">numcols</span> <span class="o">=</span> <span class="n">cols</span><span class="o">/</span><span class="p">(</span><span class="n">maxwidth</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">numrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">numstr</span><span class="o">/</span><span class="n">numcols</span><span class="p">))</span>

  <span class="c"># print the list</span>
  <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
  <span class="k">for</span> <span class="n">rind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">numrows</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">cind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">numcols</span><span class="p">):</span>
      <span class="n">sind</span> <span class="o">=</span> <span class="n">cind</span><span class="o">*</span><span class="n">numrows</span><span class="o">+</span><span class="n">rind</span>
      <span class="k">if</span> <span class="n">sind</span> <span class="o">&lt;</span> <span class="n">numstr</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">strlist</span><span class="p">[</span><span class="n">sind</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">maxwidth</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="n">sind</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

  <span class="c"># return or print result</span>
  <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="ceil"><a class="viewcode-back" href="../index.html#lnote.ceil">[docs]</a><span class="k">def</span> <span class="nf">ceil</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the ceiling of x. This exists as a substitute for numpy.ceil, to</span>
<span class="sd">    avoid importing the huge numpy module just for this function.&quot;&quot;&quot;</span>
    <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
    <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

</div>
<div class="viewcode-block" id="get_cols"><a class="viewcode-back" href="../index.html#lnote.get_cols">[docs]</a><span class="k">def</span> <span class="nf">get_cols</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Try to get the width of the shell window (will only work on Unix</span>
<span class="sd">    systems).&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s">&#39;tput cols&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c"># return default width</span>
        <span class="k">return</span> <span class="mi">80</span>


<span class="c">#def require_file(filename):</span>
  <span class="c">#&quot;&quot;&quot;If the file does not exist, create it, and also all directories along the</span>
  <span class="c">#given path.&quot;&quot;&quot;</span>
  <span class="c">#__created__ = &#39;2012-10-29&#39;</span>
  <span class="c">#__modified__ = &#39;2012-10-29&#39;</span>
  <span class="c">## copied from pool (written 2012-09-19 until 2012-09-20)</span>
  <span class="c">#filename = os.path.expanduser(filename)</span>
  <span class="c">#if not os.path.isfile(filename):</span>
    <span class="c">#path, fname = os.path.split(filename)</span>
    <span class="c">#if not os.path.isdir(path):</span>
      <span class="c">#os.makedirs(path)</span>
    <span class="c">#open(filename, &#39;w&#39;).close()</span>
  <span class="c">#if not os.path.isfile(filename):</span>
    <span class="c">#raise IOError, &#39;unable to create file&#39;</span>


<span class="c">#def require_day(day):</span>
  <span class="c">#&quot;&quot;&quot;If the tex-file and the directory for the given day do not yet exist,</span>
  <span class="c">#create them.&quot;&quot;&quot;</span>
  <span class="c">#__created__ = &#39;2012-10-29&#39;</span>
  <span class="c">#__modified__ = &#39;2012-10-29&#39;</span>
  <span class="c">#require_file(texpath(day))</span>

</div>
<div class="viewcode-block" id="texpath"><a class="viewcode-back" href="../index.html#lnote.texpath">[docs]</a><span class="k">def</span> <span class="nf">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Return the path to the tex-file of the given notebook.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">notebook</span><span class="p">,</span> <span class="n">notebook</span><span class="o">+</span><span class="s">&#39;.tex&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dirpath"><a class="viewcode-back" href="../index.html#lnote.dirpath">[docs]</a><span class="k">def</span> <span class="nf">dirpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Return the path to the directory of the given notebook.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">notebook</span><span class="p">)</span>


<span class="c">#def append_linebreak(notebook):</span>
  <span class="c">#&quot;&quot;&quot;Append linebreak to the given notebook.&quot;&quot;&quot;</span>
  <span class="c">#__created__ = &#39;2012-10-29&#39;</span>
  <span class="c">#__modified__ = &#39;2012-10-31&#39;</span>
  <span class="c">#with open(texpath(notebook), &#39;a&#39;) as texfile:</span>
    <span class="c">#texfile.write(&#39; a\n&#39;)</span>

</div>
<div class="viewcode-block" id="append_text"><a class="viewcode-back" href="../index.html#lnote.append_text">[docs]</a><span class="k">def</span> <span class="nf">append_text</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Append text to the given notebook.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">texpath</span><span class="p">(</span><span class="n">notebook</span><span class="p">),</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">texfile</span><span class="p">:</span>
    <span class="n">texfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DayFormatError"><a class="viewcode-back" href="../index.html#lnote.DayFormatError">[docs]</a><span class="k">class</span> <span class="nc">DayFormatError</span><span class="p">(</span><span class="ne">BaseException</span><span class="p">):</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>

</div>
<div class="viewcode-block" id="opt2day"><a class="viewcode-back" href="../index.html#lnote.opt2day">[docs]</a><span class="k">def</span> <span class="nf">opt2day</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Convert option string to a certain date. Return as Julian day number</span>
<span class="sd">  (integer).&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">opt</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
  <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span>

  <span class="k">if</span> <span class="s">&#39;today&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
  <span class="k">elif</span> <span class="s">&#39;yesterday&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
  <span class="k">elif</span> <span class="s">&#39;tomorrow&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
  <span class="k">elif</span> <span class="s">&#39;first&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="n">possible</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">),</span> <span class="s">&#39;????-??-??&#39;</span><span class="p">)</span>
    <span class="n">possible</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">thatday</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">thatday</span><span class="p">,</span> <span class="n">thatday</span><span class="o">+</span><span class="mi">1</span>
  <span class="k">elif</span> <span class="s">&#39;last&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="n">possible</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">),</span> <span class="s">&#39;????-??-??&#39;</span><span class="p">)</span>
    <span class="n">possible</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="s">&#39;%y/%m/</span><span class="si">%d</span><span class="s">&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">then</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DayFormatError</span><span class="p">,</span> <span class="s">&#39;bad day format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opt</span>
    <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">then</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="s">&#39;%y-%m-</span><span class="si">%d</span><span class="s">&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">then</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DayFormatError</span><span class="p">,</span> <span class="s">&#39;bad day format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opt</span>
    <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">then</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">opt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">:</span>
      <span class="n">opt</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">.%m.%Y&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">.%m.%y&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">then</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DayFormatError</span><span class="p">,</span> <span class="s">&#39;bad day format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opt</span>
    <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">then</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">DayFormatError</span><span class="p">,</span> <span class="s">&#39;bad day format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opt</span>

</div>
<div class="viewcode-block" id="opt2days"><a class="viewcode-back" href="../index.html#lnote.opt2days">[docs]</a><span class="k">def</span> <span class="nf">opt2days</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Convert option string to a list of dates. Return list of integers</span>
<span class="sd">  (Julian day numbers).&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-30&#39;</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">opt2day</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)]</span>

</div>
<div class="viewcode-block" id="DayRangeFormatError"><a class="viewcode-back" href="../index.html#lnote.DayRangeFormatError">[docs]</a><span class="k">class</span> <span class="nc">DayRangeFormatError</span><span class="p">(</span><span class="n">DayFormatError</span><span class="p">):</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>

</div>
<div class="viewcode-block" id="opt2dayrange"><a class="viewcode-back" href="../index.html#lnote.opt2dayrange">[docs]</a><span class="k">def</span> <span class="nf">opt2dayrange</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Convert option string to a timerange. Return as tuple with two integers</span>
<span class="sd">  (JDN1, JDN2+1) (Julian day numbers).&quot;&quot;&quot;</span>
  <span class="c">### support ranges like &quot;lastweek&quot; or &quot;thisweek&quot; or &quot;nextweek&quot; etc.</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">opt</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
  <span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;january&#39;</span><span class="p">,</span> <span class="s">&#39;february&#39;</span><span class="p">,</span> <span class="s">&#39;march&#39;</span><span class="p">,</span> <span class="s">&#39;april&#39;</span><span class="p">,</span> <span class="s">&#39;may&#39;</span><span class="p">,</span> <span class="s">&#39;june&#39;</span><span class="p">,</span> <span class="s">&#39;july&#39;</span><span class="p">,</span>
            <span class="s">&#39;august&#39;</span><span class="p">,</span> <span class="s">&#39;september&#39;</span><span class="p">,</span> <span class="s">&#39;october&#39;</span><span class="p">,</span> <span class="s">&#39;november&#39;</span><span class="p">,</span> <span class="s">&#39;december&#39;</span><span class="p">]</span>
  <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="p">:</span>
      <span class="c"># return &quot;empty&quot; range, not selecting any days</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">opt2day</span><span class="p">(</span><span class="s">&#39;today&#39;</span><span class="p">),)</span><span class="o">*</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&#39;only one dash (-) allowed in timerange&#39;</span>
    <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">begin</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">months</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">begin</span> <span class="ow">and</span> <span class="n">mon</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">begin</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">rbegin</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
          <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;today&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">begin</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">rbegin</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;yesterday&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">begin</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">rbegin</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="s">&#39;tomorrow&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">begin</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">rbegin</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="s">&#39;first&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">begin</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">possible</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">),</span> <span class="s">&#39;????-??-??&#39;</span><span class="p">)</span>
          <span class="n">possible</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
          <span class="n">first</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
          <span class="n">rbegin</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">begin</span> <span class="ow">and</span> <span class="n">begin</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">begin</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">begin</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">rbegin</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">begin</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">begin</span> <span class="ow">and</span> <span class="n">begin</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">year</span><span class="p">,</span> <span class="n">mon</span> <span class="o">=</span> <span class="n">begin</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
          <span class="n">rbegin</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">rbegin</span> <span class="o">=</span> <span class="n">opt2day</span><span class="p">(</span><span class="n">begin</span><span class="p">)</span> <span class="k">if</span> <span class="n">begin</span> <span class="k">else</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">months</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">and</span> <span class="n">mon</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">end</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">rend</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
          <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;today&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">end</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">rend</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="s">&#39;yesterday&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">end</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">rend</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;tomorrow&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">end</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">rend</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="s">&#39;last&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">end</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">possible</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">),</span> <span class="s">&#39;????-??-??&#39;</span><span class="p">)</span>
          <span class="n">possible</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
          <span class="n">last</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
          <span class="n">rend</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">end</span> <span class="ow">and</span> <span class="n">end</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">end</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">end</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">rend</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">end</span> <span class="ow">and</span> <span class="n">end</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">year</span><span class="p">,</span> <span class="n">mon</span> <span class="o">=</span> <span class="n">end</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
          <span class="n">rend</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">mon</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">rend</span> <span class="o">=</span> <span class="n">opt2day</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="n">end</span> <span class="k">else</span> <span class="n">opt2day</span><span class="p">(</span><span class="s">&#39;today&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">return</span> <span class="n">rbegin</span><span class="p">,</span> <span class="n">rend</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">months</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mon</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">m</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;today&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">today</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">today</span><span class="p">,</span> <span class="n">today</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="s">&#39;yesterday&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">yesterday</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
          <span class="k">return</span> <span class="n">yesterday</span><span class="p">,</span> <span class="n">yesterday</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="s">&#39;tomorrow&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">tomorrow</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
          <span class="k">return</span> <span class="n">tomorrow</span><span class="p">,</span> <span class="n">tomorrow</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="s">&#39;first&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">possible</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">),</span> <span class="s">&#39;????-??-??&#39;</span><span class="p">)</span>
          <span class="n">possible</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
          <span class="n">first</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
          <span class="n">thatday</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">thatday</span><span class="p">,</span> <span class="n">thatday</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="s">&#39;last&#39;</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
          <span class="n">possible</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">),</span> <span class="s">&#39;????-??-??&#39;</span><span class="p">)</span>
          <span class="n">possible</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
          <span class="n">last</span> <span class="o">=</span> <span class="n">possible</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
          <span class="n">thatday</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">thatday</span><span class="p">,</span> <span class="n">thatday</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">and</span> <span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">opt</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">and</span> <span class="n">opt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">year</span><span class="p">,</span> <span class="n">mon</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">mon</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">j</span> <span class="o">=</span> <span class="n">opt2day</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
  <span class="k">except</span> <span class="p">(</span><span class="n">DayFormatError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">DayRangeFormatError</span><span class="p">,</span> <span class="s">&#39;bad dayrange format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">opt</span>

</div>
<div class="viewcode-block" id="opt2dayranges"><a class="viewcode-back" href="../index.html#lnote.opt2dayranges">[docs]</a><span class="k">def</span> <span class="nf">opt2dayranges</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Convert option string to a list of timeranges. Return as list of tuples</span>
<span class="sd">  with two integers (JDN1, JDN2+1) (Julian day numbers).&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-29&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">opt2dayrange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)]</span>

</div>
<div class="viewcode-block" id="greg2jdn"><a class="viewcode-back" href="../index.html#lnote.greg2jdn">[docs]</a><span class="k">def</span> <span class="nf">greg2jdn</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Convert Gregorian date to Julian day number.</span>
<span class="sd">  Reference: http://en.wikipedia.org/wiki/Julian_Date&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-30&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-30&#39;</span>
  <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">mon</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">mday</span><span class="p">)</span>
  <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="o">-</span><span class="n">mon</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">year</span><span class="o">+</span><span class="mi">4800</span><span class="o">-</span><span class="n">a</span>
  <span class="n">m</span> <span class="o">=</span> <span class="n">mon</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">a</span><span class="o">-</span><span class="mi">3</span>
  <span class="k">return</span> <span class="n">mday</span><span class="o">+</span><span class="p">(</span><span class="mi">153</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="o">+</span><span class="mi">365</span><span class="o">*</span><span class="n">y</span><span class="o">+</span><span class="n">y</span><span class="o">/</span><span class="mi">4</span><span class="o">-</span><span class="n">y</span><span class="o">/</span><span class="mi">100</span><span class="o">+</span><span class="n">y</span><span class="o">/</span><span class="mi">400</span><span class="o">-</span><span class="mi">32045</span>

</div>
<div class="viewcode-block" id="jdn2greg"><a class="viewcode-back" href="../index.html#lnote.jdn2greg">[docs]</a><span class="k">def</span> <span class="nf">jdn2greg</span><span class="p">(</span><span class="n">jdn</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Convert Julian day number to Gregorian date.</span>
<span class="sd">  Reference: http://en.wikipedia.org/wiki/Julian_Date&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">J</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">jdn</span><span class="o">+.</span><span class="mi">5</span><span class="p">)</span>
  <span class="n">j</span> <span class="o">=</span> <span class="n">J</span><span class="o">+</span><span class="mi">32044</span>
  <span class="n">g</span> <span class="o">=</span> <span class="n">j</span><span class="o">/</span><span class="mi">146097</span><span class="p">;</span>         <span class="n">dg</span> <span class="o">=</span> <span class="n">j</span><span class="o">%</span><span class="mi">146097</span>
  <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">dg</span><span class="o">/</span><span class="mi">36524</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span> <span class="n">dc</span> <span class="o">=</span> <span class="n">dg</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="mi">36524</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">dc</span><span class="o">/</span><span class="mi">1461</span><span class="p">;</span>          <span class="n">db</span> <span class="o">=</span> <span class="n">dc</span><span class="o">%</span><span class="mi">1461</span>
  <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">db</span><span class="o">/</span><span class="mi">365</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>   <span class="n">da</span> <span class="o">=</span> <span class="n">db</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="mi">365</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="mi">400</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">a</span>
  <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">da</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">308</span><span class="p">)</span><span class="o">/</span><span class="mi">153</span><span class="o">-</span><span class="mi">2</span>
  <span class="n">d</span> <span class="o">=</span> <span class="n">da</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">153</span><span class="o">/</span><span class="mi">5</span><span class="o">+</span><span class="mi">122</span>
  <span class="n">year</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="mi">4800</span><span class="o">+</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span>
  <span class="n">mon</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">12</span><span class="o">+</span><span class="mi">1</span>
  <span class="n">mday</span> <span class="o">=</span> <span class="n">d</span><span class="o">+</span><span class="mi">1</span>
  <span class="k">return</span> <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span>

</div>
<div class="viewcode-block" id="date2filename"><a class="viewcode-back" href="../index.html#lnote.date2filename">[docs]</a><span class="k">def</span> <span class="nf">date2filename</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Convert Gregorian date to filename.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="k">return</span> <span class="s">&#39;</span><span class="si">%04i</span><span class="s">-</span><span class="si">%02i</span><span class="s">-</span><span class="si">%02i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="select_notebook"><a class="viewcode-back" href="../index.html#lnote.select_notebook">[docs]</a><span class="k">def</span> <span class="nf">select_notebook</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">forgiving</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Select a single notebook based on the given pattern. If forgiving is</span>
<span class="sd">  True, create a new notebook if the given one doesn&#39;t exist. Otherwise, only</span>
<span class="sd">  create a new notebook if pattern is None or empty.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
    <span class="c"># try to find a notebook with that name</span>
    <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">):</span>
      <span class="n">notebook</span> <span class="o">=</span> <span class="n">pattern</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c"># try to interprete string as a day</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="n">jdn2greg</span><span class="p">(</span><span class="n">opt2day</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
        <span class="n">notebook</span> <span class="o">=</span> <span class="n">date2filename</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">notebook</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">):</span>
          <span class="n">create</span><span class="p">(</span><span class="n">notebook</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">DayFormatError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">forgiving</span><span class="p">:</span>
          <span class="n">notebook</span> <span class="o">=</span> <span class="n">pattern</span>
          <span class="n">create</span><span class="p">(</span><span class="n">notebook</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">SelectNotebookError</span><span class="p">,</span> <span class="n">pattern</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c"># use today</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span> <span class="o">=</span> <span class="n">jdn2greg</span><span class="p">(</span><span class="n">opt2day</span><span class="p">(</span><span class="s">&#39;today&#39;</span><span class="p">))</span>
    <span class="n">notebook</span> <span class="o">=</span> <span class="n">date2filename</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">mday</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">notebook</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">):</span>
      <span class="n">create</span><span class="p">(</span><span class="n">notebook</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">notebook</span>

</div>
<div class="viewcode-block" id="SelectNotebookError"><a class="viewcode-back" href="../index.html#lnote.SelectNotebookError">[docs]</a><span class="k">class</span> <span class="nc">SelectNotebookError</span><span class="p">(</span><span class="ne">BaseException</span><span class="p">):</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>

</div>
<span class="k">def</span> <span class="nf">select_notebooks</span><span class="p">(</span><span class="o">*</span><span class="n">patterns</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Select notebooks based on the given string patterns. If unique is True,</span>
<span class="sd">  each notebook will be added to the list only once. If skipmissing is True,</span>
<span class="sd">  no exception is raised if there is nothing found for a pattern.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-10-31&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2013-11-29&#39;</span>

  <span class="c"># get keyword arguments</span>
  <span class="n">unique</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;unique&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
  <span class="n">forgiving</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;forgiving&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> \
          <span class="s">&#39;select_notebooks() got an unexpected keyword argument </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s">&#39;</span> \
          <span class="o">%</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

  <span class="n">notebooks</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
    <span class="c"># first try to glob</span>
    <span class="n">raised</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">,</span> <span class="n">pattern</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">raised</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">raised</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c">#results.sort()</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">notebook</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">unique</span> <span class="ow">or</span> <span class="n">notebook</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">:</span>
                <span class="n">notebooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">notebook</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># try to interprete the pattern as a day or dayrange</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dayrange</span> <span class="o">=</span> <span class="n">opt2dayrange</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DayRangeFormatError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">forgiving</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SelectNotebookError</span><span class="p">,</span> <span class="n">pattern</span>

        <span class="c"># select all notebooks according to dayrange</span>
        <span class="n">dirnames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">LNOTE_DIR</span><span class="p">)</span>
        <span class="n">dirnames</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">date</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">jdn</span> <span class="o">=</span> <span class="n">greg2jdn</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">jdn</span> <span class="o">&gt;=</span> <span class="n">dayrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">jdn</span> <span class="o">&lt;</span> <span class="n">dayrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">unique</span> <span class="ow">or</span> <span class="n">dirname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">notebooks</span><span class="p">:</span>
                    <span class="n">notebooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">notebooks</span>


<div class="viewcode-block" id="plural"><a class="viewcode-back" href="../index.html#lnote.plural">[docs]</a><span class="k">def</span> <span class="nf">plural</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;If abs(number) == 1, return &quot;&quot;, otherwise return &quot;s&quot;. For conveniently</span>
<span class="sd">  appending the plural &quot;s&quot; to words depending on some number.&quot;&quot;&quot;</span>
  <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2012-11-02&#39;</span>
  <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2012-11-02&#39;</span>
  <span class="k">return</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&#39;s&#39;</span>

</div>
<div class="viewcode-block" id="get_size"><a class="viewcode-back" href="../index.html#lnote.get_size">[docs]</a><span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return total size of a file or directory in bytes.</span>

<span class="sd">    Reference:</span>
<span class="sd">    http://stackoverflow.com/questions/1392413/calculating-a-directory-size-using-python</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2013-11-08&#39;</span>
    <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2013-11-08&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">total_size</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">total_size</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

</div>
<div class="viewcode-block" id="get_mtime"><a class="viewcode-back" href="../index.html#lnote.get_mtime">[docs]</a><span class="k">def</span> <span class="nf">get_mtime</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return last modification time of a file or all files within a directory</span>
<span class="sd">    tree (in seconds since the epoch).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__created__</span> <span class="o">=</span> <span class="s">&#39;2013-11-08&#39;</span>
    <span class="n">__modified__</span> <span class="o">=</span> <span class="s">&#39;2013-11-08&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">newmtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newmtime</span> <span class="o">&gt;</span> <span class="n">mtime</span><span class="p">:</span>
                <span class="n">mtime</span> <span class="o">=</span> <span class="n">newmtime</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">newmtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newmtime</span> <span class="o">&gt;</span> <span class="n">mtime</span><span class="p">:</span>
                    <span class="n">mtime</span> <span class="o">=</span> <span class="n">newmtime</span>
        <span class="k">return</span> <span class="n">mtime</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>


<span class="c">#==============#</span>
<span class="c"># Main program #</span>
<span class="c">#==============#</span>


<span class="c"># map commands (second element of sys.argv) to functions</span></div>
<span class="n">_cmd2func</span> <span class="o">=</span> <span class="p">{</span>
             <span class="c">## here, positional parameters are notebooks ##</span>
             <span class="s">&#39;create&#39;</span>    <span class="p">:</span> <span class="n">create</span><span class="p">,</span>
             <span class="s">&#39;c&#39;</span>         <span class="p">:</span> <span class="n">create</span><span class="p">,</span>
             <span class="s">&#39;delete&#39;</span>    <span class="p">:</span> <span class="n">delete</span><span class="p">,</span>
             <span class="s">&#39;d&#39;</span>         <span class="p">:</span> <span class="n">delete</span><span class="p">,</span>
             <span class="s">&#39;rename&#39;</span>    <span class="p">:</span> <span class="n">rename</span><span class="p">,</span>
             <span class="s">&#39;r&#39;</span>         <span class="p">:</span> <span class="n">rename</span><span class="p">,</span>
             <span class="s">&#39;list&#39;</span>      <span class="p">:</span> <span class="n">listn</span><span class="p">,</span>
             <span class="s">&#39;l&#39;</span>         <span class="p">:</span> <span class="n">listn</span><span class="p">,</span>
             <span class="s">&#39;edit&#39;</span>      <span class="p">:</span> <span class="n">edit</span><span class="p">,</span>
             <span class="s">&#39;e&#39;</span>         <span class="p">:</span> <span class="n">edit</span><span class="p">,</span>
             <span class="s">&#39;merge&#39;</span>     <span class="p">:</span> <span class="n">merge</span><span class="p">,</span>
             <span class="s">&#39;m&#39;</span>         <span class="p">:</span> <span class="n">merge</span><span class="p">,</span>
             <span class="s">&#39;export&#39;</span>    <span class="p">:</span> <span class="n">export</span><span class="p">,</span>
             <span class="s">&#39;x&#39;</span>         <span class="p">:</span> <span class="n">export</span><span class="p">,</span>
             <span class="s">&#39;view&#39;</span>      <span class="p">:</span> <span class="n">view</span><span class="p">,</span>
             <span class="s">&#39;v&#39;</span>         <span class="p">:</span> <span class="n">view</span><span class="p">,</span>
             <span class="s">&#39;path&#39;</span>      <span class="p">:</span> <span class="n">path</span><span class="p">,</span>

             <span class="c">## here, positional parameters are not notebooks but text ##</span>
             <span class="c">## instead, notebooks are selected using the -n option    ##</span>
             <span class="s">&#39;text&#39;</span>      <span class="p">:</span> <span class="n">text</span><span class="p">,</span>
             <span class="s">&#39;t&#39;</span>         <span class="p">:</span> <span class="n">text</span><span class="p">,</span>
             <span class="s">&#39;linebreak&#39;</span> <span class="p">:</span> <span class="n">linebreak</span><span class="p">,</span>
             <span class="s">&#39;b&#39;</span>         <span class="p">:</span> <span class="n">linebreak</span><span class="p">,</span>
             <span class="s">&#39;equation&#39;</span>  <span class="p">:</span> <span class="n">equation</span><span class="p">,</span>
             <span class="s">&#39;q&#39;</span>         <span class="p">:</span> <span class="n">equation</span><span class="p">,</span>
             <span class="s">&#39;section&#39;</span>   <span class="p">:</span> <span class="n">section</span><span class="p">,</span>
             <span class="s">&#39;s&#39;</span>         <span class="p">:</span> <span class="n">section</span><span class="p">,</span>
             <span class="s">&#39;paragraph&#39;</span> <span class="p">:</span> <span class="n">paragraph</span><span class="p">,</span>
             <span class="s">&#39;p&#39;</span>         <span class="p">:</span> <span class="n">paragraph</span><span class="p">,</span>
             <span class="s">&#39;item&#39;</span>      <span class="p">:</span> <span class="n">item</span><span class="p">,</span>
             <span class="s">&#39;i&#39;</span>         <span class="p">:</span> <span class="n">item</span><span class="p">,</span>
             <span class="s">&#39;prune&#39;</span>     <span class="p">:</span> <span class="n">prune</span><span class="p">,</span>
             <span class="s">&#39;u&#39;</span>         <span class="p">:</span> <span class="n">prune</span><span class="p">,</span>
             <span class="s">&#39;marginnote&#39;</span><span class="p">:</span> <span class="n">marginnote</span><span class="p">,</span>
             <span class="s">&#39;n&#39;</span>         <span class="p">:</span> <span class="n">marginnote</span><span class="p">,</span>

             <span class="c">## here, positional parameters are files (graphics files) ##</span>
             <span class="s">&#39;figure&#39;</span>    <span class="p">:</span> <span class="n">figure</span><span class="p">,</span>
             <span class="s">&#39;f&#39;</span>         <span class="p">:</span> <span class="n">figure</span>
            <span class="p">}</span>


<div class="viewcode-block" id="call"><a class="viewcode-back" href="../index.html#lnote.call">[docs]</a><span class="k">def</span> <span class="nf">call</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This function should be called by an executable file with the following</span>
<span class="sd">    content:</span>

<span class="sd">    &gt;&gt;&gt; import sys, lnote</span>
<span class="sd">    &gt;&gt;&gt; if __name__ == &#39;__main__&#39;:</span>
<span class="sd">    &gt;&gt;&gt;     sys.exit(lnote.call())&quot;&quot;&quot;</span>
    <span class="c"># 2012-10-29 - 2012-11-15</span>

    <span class="c"># return words for custom tab completion</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;--comp-words&#39;</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">_cmd2func</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c"># to enable custom tab completion, add the following lines to your .bashrc</span>
    <span class="c"># (see http://aplawrence.com/Unix/customtab.html#ixzz27bkFS2Y0):</span>
    <span class="c">#lnotewords=&#39;create edit equation figure linebreak list paragraph prune</span>
                <span class="c">#rename section text merge delete export view&#39;</span>
    <span class="c">#notebooks=&quot;`ls ~/data/lnote` today yesterday tomorrow&quot;</span>
    <span class="c">#_lnote()</span>
    <span class="c">#{</span>
        <span class="c">#local curw</span>
        <span class="c">#COMPREPLY=()</span>
        <span class="c">#curw=${COMP_WORDS[COMP_CWORD]}</span>
        <span class="c">#cur1=${COMP_WORDS[1]}</span>
        <span class="c">#if [ $COMP_CWORD == 1 ]</span>
        <span class="c">#then</span>
        <span class="c">#COMPREPLY=($(compgen -W &#39;$lnotewords&#39; -- $curw))</span>
        <span class="c">#else</span>
        <span class="c">#if [ &quot;$cur1&quot; == &quot;figure&quot; ] || [ &quot;$cur1&quot; == &quot;f&quot; ]</span>
        <span class="c">#then</span>
            <span class="c">#COMPREPLY=($(compgen -A file -- $curw))</span>
        <span class="c">#elif [ &quot;$cur1&quot; == &quot;create&quot; ] || [ &quot;$cur1&quot; == &quot;c&quot; ] \</span>
            <span class="c">#|| [ &quot;$cur1&quot; == &quot;delete&quot; ] || [ &quot;$cur1&quot; == &quot;d&quot; ] \</span>
            <span class="c">#|| [ &quot;$cur1&quot; == &quot;rename&quot; ] || [ &quot;$cur1&quot; == &quot;r&quot; ] \</span>
            <span class="c">#|| [ &quot;$cur1&quot; == &quot;list&quot; ] || [ &quot;$cur1&quot; == &quot;l&quot; ] \</span>
            <span class="c">#|| [ &quot;$cur1&quot; == &quot;edit&quot; ] || [ &quot;$cur1&quot; == &quot;e&quot; ] \</span>
            <span class="c">#|| [ &quot;$cur1&quot; == &quot;merge&quot; ] || [ &quot;$cur1&quot; == &quot;m&quot; ] \</span>
            <span class="c">#|| [ &quot;$cur1&quot; == &quot;view&quot; ] || [ &quot;$cur1&quot; == &quot;v&quot; ] \</span>
            <span class="c">#|| [ &quot;$cur1&quot; == &quot;export&quot; ] || [ &quot;$cur1&quot; == &quot;x&quot; ]</span>
        <span class="c">#then</span>
            <span class="c">#COMPREPLY=($(compgen -W &#39;$notebooks&#39; -- $curw))</span>
        <span class="c">#else</span>
            <span class="c">#COMPREPLY=($(compgen -W &#39;&#39; -- $curw))</span>
        <span class="c">#fi</span>
        <span class="c">#fi</span>
        <span class="c">#return 0</span>
    <span class="c">#}</span>
    <span class="c">#complete -F _lnote -o dirnames lnote</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;-?&#39;</span><span class="p">,</span> <span class="s">&#39;--help&#39;</span><span class="p">):</span>
        <span class="c"># display help</span>
        <span class="n">cmds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">_cmd2func</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span>
            <span class="k">if</span> <span class="n">func</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cmds</span><span class="p">:</span>
                <span class="n">cmds</span><span class="p">[</span><span class="n">func</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;longs&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;shorts&#39;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cmds</span><span class="p">[</span><span class="n">func</span><span class="p">][</span><span class="s">&#39;shorts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmds</span><span class="p">[</span><span class="n">func</span><span class="p">][</span><span class="s">&#39;longs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="n">cmds</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">cmdstrings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">cmdstring</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="s">&#39;longs&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cmdstring</span> <span class="o">+=</span> <span class="n">cmd</span><span class="p">[</span><span class="s">&#39;longs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="s">&#39;shorts&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cmdstring</span> <span class="o">+=</span> <span class="s">&#39; (&#39;</span>
                    <span class="n">cmdstring</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">short</span> <span class="k">for</span> <span class="n">short</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">[</span><span class="s">&#39;shorts&#39;</span><span class="p">])</span>
                    <span class="n">cmdstring</span> <span class="o">+=</span> <span class="s">&#39;)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmdstring</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">short</span> <span class="k">for</span> <span class="n">short</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">[</span><span class="s">&#39;shorts&#39;</span><span class="p">])</span>
            <span class="n">cmdstrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmdstring</span><span class="p">)</span>

        <span class="k">print</span> <span class="n">__doc__</span>
        <span class="k">print</span>
        <span class="k">print</span> <span class="s">&#39;Available commands (with shortcuts):&#39;</span>
        <span class="n">printcols</span><span class="p">(</span><span class="n">cmdstrings</span><span class="p">)</span>
        <span class="k">print</span>
        <span class="k">print</span> <span class="s">&#39;To get help to a specific command,&#39;</span><span class="p">,</span>
        <span class="k">print</span> <span class="s">&#39;use &quot;-?&quot;, e.g. &quot;lnote create -?&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># execute command</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">_cmd2func</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: command not found. &#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
                                <span class="s">&#39;Type &quot;lnote -?&quot; for a list of lnote commands&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">call</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">lnote 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Daniel Jung.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>